(defpackage #:dlgo.zobrist
  (:use #:common-lisp)
  (:import-from #:dlgo.constant
		#:black
		#:white
		#:+big-board+)
  (:import-from #:dlgo.point
		#:point-index
		#:point-to-coords
		#:index-to-point
		#:make-point)
  (:import-from #:alexandria
		#:define-constant)
  (:import-from #:binding-arrows
		#:->>)
  (:export #:zobrist-hash
	   #:generate-hash-codes
	   #:+empty-board-hash+))

(in-package #:dlgo.zobrist)

(defun hash-index (point color)
  "Return the index corresponding to POINT and COLOR.
If COLOR is NIL, then it means that POINT is empty."

  ;; First 19x19 positions are for empty points, then 19x19 positions
  ;; for black and the remaining 19x19 for white.
  (let ((offset (case color
		  (black 361)  		; 19x19
		  (white 722) 		; 2x19x19
		  (t 0))))
    (+ offset (* (point-index point +big-board+)))))

(defun index-label (index)
  "Return a label that corresponds to INDEX in vector holding hash codes.
This function is used for generating the comments in GENERATE-HASH-CODES.
i.e. 'B A3'"
  (flet ((color-at-index (index)
	   (cond ((< index 361) "E")
		 ((< index 722) "B")
		 (t "W")))

	 (coords-at-index (index)
	   (let ((index-no-offset
		   (- index
		      (cond ((< index 361) 0)
			    ((< index 722) 361)
			    (t 722)))))
	     (->> (index-to-point index-no-offset)
	       point-to-coords))))
    (format nil "~a ~a"
	    (color-at-index index)
	    (coords-at-index index))))

(defun generate-hash-codes ()
  "Return a string with the code for the zobrist hash codes that
represent board positions.  Copy this string into a .lisp file so you
can use the same hashes every time."

  ;; ATTENTION: For efficiency reasons we use 62 bits
  ;; (most-positive-fixnum) instead of 63. This results in higher
  ;; chances of collisions. In case a colision is detected then this
  ;; should be changed.
  (with-output-to-string (sb)
    (format sb "#(")
    (dotimes (i (* +big-board+ +big-board+ 3))
      (format sb "~25a; ~a~%"
	      (random most-positive-fixnum)
	      (index-label i)))
    (format sb "")
    sb))

(define-constant +empty-board-hash+ 0)
(define-constant +board-hashes+
    #(927511022209212219		; E A1
      2617341095834123661		; E A2
      3168436480419461498		; E A3
      3057280792033462279		; E A4
      778587728116765869		; E A5
      3864453155235301768		; E A6
      2872908764502363322		; E A7
      658764211421037440		; E A8
      1828612928824192076		; E A9
      3394076317789819942		; E A10
      3297081721510672966		; E A11
      142780117852819149		; E A12
      4485002472557496558		; E A13
      2623625433644396594		; E A14
      2868060911975951755		; E A15
      3157837055997390270		; E A16
      3800879376998500697		; E A17
      587212336705139504		; E A18
      496641365834694338		; E A19
      851711823826408804		; E B1
      1791765016181687769		; E B2
      1355057688587288730		; E B3
      3593953733895780935		; E B4
      1237766916077330158		; E B5
      3693444831810895432		; E B6
      635418028923817256		; E B7
      3481718906945192707		; E B8
      2426825207983391500		; E B9
      286234290320868617		; E B10
      833791063709988543		; E B11
      3447191090541796089		; E B12
      4422872433359243004		; E B13
      3607928566895956275		; E B14
      2698998679607570840		; E B15
      3862099424754692935		; E B16
      86453949925317232			; E B17
      480077948295946001		; E B18
      3314929331854685555		; E B19
      2861053185511960684		; E C1
      2999657006842421264		; E C2
      2195119737828970803		; E C3
      4581508069701152470		; E C4
      3869093051655886328		; E C5
      1667322336890793096		; E C6
      1572912306820781763		; E C7
      4128601643376497788		; E C8
      23373138242645347			; E C9
      93988203087961891			; E C10
      109888095220445449		; E C11
      3672317329001448257		; E C12
      2599206276828531855		; E C13
      3860745284530836394		; E C14
      870972862401771068		; E C15
      2557169577930838299		; E C16
      2753988324592681474		; E C17
      138502751629525869		; E C18
      1673437898353918058		; E C19
      78992258251838628			; E D1
      1185845758818108746		; E D2
      4492242784710249690		; E D3
      3306830239931098663		; E D4
      1844374929211461084		; E D5
      3626542162137919338		; E D6
      19993566490920989			; E D7
      2140646359762851615		; E D8
      4118952148812310387		; E D9
      1875286999234899535		; E D10
      1491025040113219082		; E D11
      1572844883506455208		; E D12
      917238660604670591		; E D13
      3084178742222440514		; E D14
      661113190532819832		; E D15
      132820800161914176		; E D16
      68789590194010753			; E D17
      2406301139814576828		; E D18
      1251088460505272543		; E D19
      1399264737199011230		; E E1
      995204053540447006		; E E2
      568114589716401730		; E E3
      538040450305060794		; E E4
      3394397896094255425		; E E5
      2396346607982954160		; E E6
      1269572422925333593		; E E7
      4047042964791612174		; E E8
      219554440621438051		; E E9
      1607129162709553047		; E E10
      2991735439098915774		; E E11
      816905586185954966		; E E12
      1129218155036047944		; E E13
      526343455900690928		; E E14
      3055679836444599521		; E E15
      1881234744697563444		; E E16
      239277929511035745		; E E17
      2842257643343690108		; E E18
      3490391427703267400		; E E19
      4577588891489824420		; E F1
      3699339563742937709		; E F2
      1546231510864932275		; E F3
      4223879537813379484		; E F4
      3013042508275561346		; E F5
      2810878285747130284		; E F6
      1398576327206155687		; E F7
      707293043399422824		; E F8
      4540384104332715056		; E F9
      1442083973936008388		; E F10
      3554286753742252576		; E F11
      1967396414449293184		; E F12
      3908829614081599368		; E F13
      85486376371946746			; E F14
      459516970352299562		; E F15
      1241525341453404595		; E F16
      2189530886825115821		; E F17
      1557566515537166444		; E F18
      2763002127899599368		; E F19
      182076862305469876		; E G1
      923600370146318167		; E G2
      3346494415521456561		; E G3
      2963425077150615332		; E G4
      3354485508116577118		; E G5
      254618885920731739		; E G6
      2684720406528345819		; E G7
      2510021776475893088		; E G8
      2200552861242935048		; E G9
      1470290165654897293		; E G10
      919758433200271694		; E G11
      2673944069002447600		; E G12
      1900588623513769748		; E G13
      2251519770816706608		; E G14
      1862242823346440668		; E G15
      244410934252277262		; E G16
      2800363994834047556		; E G17
      1401338086955027092		; E G18
      4425671917019353236		; E G19
      2274832813847066884		; E H1
      3392499943774661634		; E H2
      4426342811450096885		; E H3
      3085532779137610976		; E H4
      915962471591573851		; E H5
      2817115011187772913		; E H6
      3593189530033066913		; E H7
      4443158310320009411		; E H8
      4413432185806602940		; E H9
      1618137458090837268		; E H10
      2768004946556476969		; E H11
      2199714865688627700		; E H12
      2051328745510403276		; E H13
      558052049499646951		; E H14
      2577726641955821537		; E H15
      4458417276962677916		; E H16
      2839177893933788572		; E H17
      1779272043929406626		; E H18
      2434477591072368156		; E H19
      3542707974390098753		; E J1
      3802511068809882427		; E J2
      1387353682008064543		; E J3
      1102737957538513635		; E J4
      4330924914900574068		; E J5
      1902939866935289895		; E J6
      1313298243409416298		; E J7
      284143334256860198		; E J8
      793649006026627834		; E J9
      3117315789789830733		; E J10
      2750695051165150737		; E J11
      4274523600121077554		; E J12
      2725431951460313889		; E J13
      3706388230672050035		; E J14
      867160965369406857		; E J15
      854468089619519075		; E J16
      4513785557307455830		; E J17
      3485604747192760612		; E J18
      3445398692901717472		; E J19
      3385183290380905661		; E K1
      2185655003816642491		; E K2
      2317253387908169165		; E K3
      557597791389893967		; E K4
      1496506254122653639		; E K5
      3309087100252458376		; E K6
      474315195674109229		; E K7
      4368034576335554932		; E K8
      3428485760986516720		; E K9
      3630019466046960215		; E K10
      1039464334719840793		; E K11
      156957047492070902		; E K12
      198700218940952402		; E K13
      1247511074155093538		; E K14
      826993581666876766		; E K15
      2662199669323912803		; E K16
      2372424473306494832		; E K17
      1135959021756014160		; E K18
      605525229567787301		; E K19
      1858087067925862547		; E L1
      3486463476203101712		; E L2
      2323234822219805033		; E L3
      925221229508184239		; E L4
      2259266570433444077		; E L5
      1605691332591154145		; E L6
      3832168925610015742		; E L7
      945328052890055113		; E L8
      4075316350156957685		; E L9
      4251756172036174608		; E L10
      1739690096326657489		; E L11
      3592767048674182493		; E L12
      4167521353376210747		; E L13
      3149007663825684624		; E L14
      4199664985908318731		; E L15
      3425536144884335574		; E L16
      1127138292328736383		; E L17
      3198289932795855750		; E L18
      3324239560938911193		; E L19
      3409259357477147380		; E M1
      2857049580275893634		; E M2
      4238109554091069583		; E M3
      3484036048477954366		; E M4
      2049787816662205948		; E M5
      148767445808471197		; E M6
      2927864410095258678		; E M7
      1750523595405531988		; E M8
      225266980406693669		; E M9
      1897120082071391704		; E M10
      3896243423679934381		; E M11
      4090505149515724196		; E M12
      2165973419180478318		; E M13
      861017847606882557		; E M14
      1268735686095245716		; E M15
      3212809572841108155		; E M16
      144959768110968736		; E M17
      1577487899486079633		; E M18
      230256697916756247		; E M19
      941053644505053484		; E N1
      539019036740247617		; E N2
      3299276603753748580		; E N3
      4248854577627660142		; E N4
      4401558730679115742		; E N5
      1448531666574817979		; E N6
      4377109344265228494		; E N7
      3852580893721481065		; E N8
      3930789771669806197		; E N9
      863413144729371757		; E N10
      389887326536181151		; E N11
      4272162365707740014		; E N12
      4406885521214499374		; E N13
      2288504686532041096		; E N14
      3304467501463546087		; E N15
      2684281956311472806		; E N16
      2166323896357064805		; E N17
      4389993034116046584		; E N18
      696159153882383399		; E N19
      2493409651103599632		; E O1
      3012110330548452791		; E O2
      851942070296079280		; E O3
      1820920129384385698		; E O4
      218984775919767017		; E O5
      1574555867629124330		; E O6
      3315395530321686819		; E O7
      2518960711713697166		; E O8
      4080927142233464847		; E O9
      1969408782735860913		; E O10
      2836322558912542817		; E O11
      4504214121280290358		; E O12
      535909725319838952		; E O13
      3966734063028688677		; E O14
      2835643882710978870		; E O15
      2599561328598720961		; E O16
      1552534224220718055		; E O17
      3666213504672662012		; E O18
      3648947304276969104		; E O19
      563380963800373267		; E P1
      4502375379970216121		; E P2
      413872729254488			; E P3
      4241314862615624799		; E P4
      2854121527286479931		; E P5
      2026681855657053154		; E P6
      2170561741966502410		; E P7
      2018854177587134707		; E P8
      1023599225378170862		; E P9
      1415262202360204777		; E P10
      3374323980364780765		; E P11
      4425964474268112090		; E P12
      2518200698590122520		; E P13
      528944732803907763		; E P14
      4425399548531597867		; E P15
      3097709049996050795		; E P16
      4218413469201766130		; E P17
      3923520419867729203		; E P18
      8699990219261215			; E P19
      4078360749325920606		; E Q1
      1099773882569929996		; E Q2
      3356789073248483963		; E Q3
      782716291171393371		; E Q4
      1317936110638341768		; E Q5
      399369027237444881		; E Q6
      1784354081446892987		; E Q7
      1257119034986870283		; E Q8
      1246023954059824486		; E Q9
      4103286194256266771		; E Q10
      2764529561460969219		; E Q11
      2944197321557442843		; E Q12
      343016102531517951		; E Q13
      4113154630822156481		; E Q14
      2748407883948851876		; E Q15
      928435287041046838		; E Q16
      3759404151878637009		; E Q17
      3364529453472136032		; E Q18
      1389294374785118030		; E Q19
      1539746273432534259		; E R1
      2456571506656134064		; E R2
      3198455306514491463		; E R3
      2599843620743881780		; E R4
      1501191285236027999		; E R5
      984399346237741442		; E R6
      1115496406322576861		; E R7
      2753319802745152852		; E R8
      495771501970067774		; E R9
      3076907040132956298		; E R10
      2893554274506777198		; E R11
      2360691783905089584		; E R12
      774469502788898882		; E R13
      3350872699210346420		; E R14
      285686994513496970		; E R15
      4317713645923171823		; E R16
      3083712972247263665		; E R17
      1959345751631295833		; E R18
      2258061120927485400		; E R19
      3654639395874750845		; E S1
      4421456604890022905		; E S2
      1650862144193037591		; E S3
      3719425494375459775		; E S4
      3142071498458061475		; E S5
      971719028887446290		; E S6
      4387707499041307867		; E S7
      352691079160329491		; E S8
      3188254303275974874		; E S9
      883062226568524923		; E S10
      3555369839383527763		; E S11
      3094332491035071177		; E S12
      4299059195328322956		; E S13
      949176301891896610		; E S14
      3709617332006607148		; E S15
      3068410203769658355		; E S16
      721755867722228517		; E S17
      3654401776631080358		; E S18
      3071897860870724206		; E S19
      3285963828928157833		; E T1
      2361448769171014076		; E T2
      4594722210468935737		; E T3
      3156626426854283980		; E T4
      601379074786645364		; E T5
      1128936999041762492		; E T6
      2432507698307606368		; E T7
      3120733626835199294		; E T8
      3512873724957023689		; E T9
      2193623131470541778		; E T10
      3887207376685534246		; E T11
      4272965958797385456		; E T12
      2885162175363996128		; E T13
      1946552164012328944		; E T14
      2670434413083502426		; E T15
      2329311188004137366		; E T16
      3521920567358928506		; E T17
      3288187343866276680		; E T18
      4280051587019743573		; E T19
      2224891563145194363		; B A1
      1651121661658372412		; B A2
      4172426241806036450		; B A3
      2483284609554024110		; B A4
      1530828537661036785		; B A5
      33316991840024306			; B A6
      745998625233711604		; B A7
      2159945596424119634		; B A8
      281882938459094384		; B A9
      1371999915986094863		; B A10
      4291882147544920103		; B A11
      4247340471398749645		; B A12
      1731725153855445102		; B A13
      1550805380428744010		; B A14
      1987987410552862541		; B A15
      2883376459011611253		; B A16
      2391689124712189904		; B A17
      1249961739397956485		; B A18
      197896655423538933		; B A19
      1740565542520371929		; B B1
      415284068847593924		; B B2
      3232963827085375560		; B B3
      1156959299963156580		; B B4
      2978867745258053803		; B B5
      3297654077572988203		; B B6
      3189178111359770660		; B B7
      1738224442561375524		; B B8
      1817440777270821091		; B B9
      4075333151417567420		; B B10
      3614626788068473131		; B B11
      3687280053000497098		; B B12
      2555441368438937814		; B B13
      619881362109192115		; B B14
      1269248573377193128		; B B15
      1283888545056468974		; B B16
      569345467378373450		; B B17
      2849020414944340041		; B B18
      2907561040472159707		; B B19
      1290925635936833482		; B C1
      4028011641971801240		; B C2
      4033368282606349600		; B C3
      578008571537840340		; B C4
      1386193198704419903		; B C5
      1948514862827556080		; B C6
      2046825978745783170		; B C7
      531307565523196217		; B C8
      3199641623658610856		; B C9
      1675393934175561339		; B C10
      303845438722877850		; B C11
      2834466078735484722		; B C12
      571946953254216012		; B C13
      3506451932921100674		; B C14
      500695253431121799		; B C15
      3826304248932287788		; B C16
      2312697786125079930		; B C17
      333002562519646281		; B C18
      3571706926999514245		; B C19
      2540284543247004935		; B D1
      3831276896055947331		; B D2
      4440261110786910578		; B D3
      3248883031905609002		; B D4
      720614148646463689		; B D5
      3169301265647556110		; B D6
      3599706818388506633		; B D7
      1254245112763623990		; B D8
      88362767084041169			; B D9
      4132809027272060210		; B D10
      3095967347732086323		; B D11
      1741227943314857003		; B D12
      1742523960159504918		; B D13
      562988296522596958		; B D14
      3234305741256294250		; B D15
      123875739799564705		; B D16
      1884712758704722332		; B D17
      2522983112385041939		; B D18
      3061997958975983152		; B D19
      21233262920564958			; B E1
      3918995232541206377		; B E2
      3216172249715617758		; B E3
      3890720251553830592		; B E4
      371881306567461819		; B E5
      1336868955133734233		; B E6
      640826876881887975		; B E7
      4083318777664617531		; B E8
      659705953632097041		; B E9
      3244310399318937850		; B E10
      4090713659768179624		; B E11
      4122588990659590974		; B E12
      2817208883017020917		; B E13
      1680952277505416654		; B E14
      1980981386493831707		; B E15
      3537075612637790890		; B E16
      4398198904085301175		; B E17
      4479784404507195044		; B E18
      3088433994413397653		; B E19
      351624165841246545		; B F1
      285924932260458821		; B F2
      3480199136027580990		; B F3
      691719230190816182		; B F4
      1680746820714779923		; B F5
      1405814933928848245		; B F6
      3382454712810440351		; B F7
      859491211467219010		; B F8
      3241624878304450901		; B F9
      2664498986104159926		; B F10
      2723064524432004272		; B F11
      3302276263735036439		; B F12
      2504822658330100342		; B F13
      3600326923771002290		; B F14
      3854169096924896318		; B F15
      3860565926992152663		; B F16
      4357685004026203623		; B F17
      2202472020278489715		; B F18
      1979408358331929912		; B F19
      3691888750055554895		; B G1
      3850305765017500161		; B G2
      2987353360137224930		; B G3
      374201678700765000		; B G4
      1848696070731258368		; B G5
      2988549648303096121		; B G6
      3065084931407691598		; B G7
      1695793585479058544		; B G8
      1529545404679139418		; B G9
      118815388339463702		; B G10
      2092981132830068608		; B G11
      1517229280686530888		; B G12
      751508162856707708		; B G13
      2212521418026430836		; B G14
      272624918951711010		; B G15
      1255745017745257659		; B G16
      2199120029088776224		; B G17
      3501735688319427989		; B G18
      2684958110128741155		; B G19
      4232849393215226361		; B H1
      2569944319151578899		; B H2
      824866605812465086		; B H3
      2717417180419949325		; B H4
      809552563161747043		; B H5
      4077590502252264763		; B H6
      414965119349581655		; B H7
      4495556751149318186		; B H8
      4033871873685216540		; B H9
      1951633658400603366		; B H10
      2023561057349820658		; B H11
      1173053787278591138		; B H12
      2851497639740454008		; B H13
      3659334270539214411		; B H14
      2136431404881349586		; B H15
      249116702603848771		; B H16
      2359271837550107416		; B H17
      405466582611862278		; B H18
      3373053002967373904		; B H19
      4108843506781949860		; B J1
      3542297726917264733		; B J2
      2561776764523527012		; B J3
      3620474782088039931		; B J4
      1730673959024313162		; B J5
      468628526103295265		; B J6
      559752140033479270		; B J7
      2050167613182338991		; B J8
      4332279231002439315		; B J9
      2646302716859839677		; B J10
      3162346418498428290		; B J11
      4450423577288232010		; B J12
      369902776809595525		; B J13
      1802480657827728143		; B J14
      2766960995792534253		; B J15
      1588118298604740600		; B J16
      224041488408252609		; B J17
      820033262244148292		; B J18
      91002664369577195			; B J19
      4478599396343102580		; B K1
      3549196211223597816		; B K2
      3464226229908075632		; B K3
      2014904841868939970		; B K4
      4359704881961692135		; B K5
      2669381743755713961		; B K6
      3383425504396657666		; B K7
      3764010792353183179		; B K8
      3547408767611718405		; B K9
      361143511152116515		; B K10
      1491564604741223775		; B K11
      3215442674920098892		; B K12
      373923298120826367		; B K13
      3635001032477181399		; B K14
      1323022277741554381		; B K15
      3318964100510644909		; B K16
      2541425588052508761		; B K17
      2604366544570834153		; B K18
      352598237753505755		; B K19
      2707825452050468056		; B L1
      1079394675297057951		; B L2
      93655853676971076			; B L3
      2350033032587013976		; B L4
      3984845665266627881		; B L5
      745381554020522704		; B L6
      3676508237045219810		; B L7
      1430829731451335330		; B L8
      3159269953240786176		; B L9
      3479885586563574661		; B L10
      1540314168266221038		; B L11
      347799532112385459		; B L12
      3085283309804170142		; B L13
      2065675307528408888		; B L14
      4424860191523869635		; B L15
      266065753158316728		; B L16
      2477047564645299889		; B L17
      1623794167362064921		; B L18
      2854676979836763176		; B L19
      3686818300737567318		; B M1
      2895305635290633467		; B M2
      4587810696548599262		; B M3
      1394275306436851066		; B M4
      737187800495513762		; B M5
      1264049280248063187		; B M6
      628372191417811022		; B M7
      1659297151241734159		; B M8
      2060607365340619680		; B M9
      2514153773212310670		; B M10
      3295553374808068137		; B M11
      4522717731371635305		; B M12
      3499539347084114907		; B M13
      4519559730897406954		; B M14
      2722891103330479743		; B M15
      1014094074521803800		; B M16
      1857820927415906877		; B M17
      1117126092547327077		; B M18
      3313198842380613857		; B M19
      3627869435804845253		; B N1
      1527223790926107311		; B N2
      1206365655886751743		; B N3
      2379886476537826167		; B N4
      4407141436367182944		; B N5
      9636120050020870			; B N6
      2129466115922276445		; B N7
      2076484809713699469		; B N8
      4426300006177231444		; B N9
      510607268664449918		; B N10
      4233959120738789895		; B N11
      947196011188501492		; B N12
      4202960391356763434		; B N13
      4576532012161709069		; B N14
      2782737306851677327		; B N15
      1377256387600225855		; B N16
      1755727606718413763		; B N17
      4402136388561432328		; B N18
      1586180890068360448		; B N19
      4551448593134454888		; B O1
      3069837373526902215		; B O2
      1539986085774119485		; B O3
      2323547977599325498		; B O4
      2968903006295357493		; B O5
      4238173693714572983		; B O6
      2596418357040131382		; B O7
      4285238120398646169		; B O8
      351024595891262460		; B O9
      1502422550857392773		; B O10
      3289295412656496316		; B O11
      1477406472483760731		; B O12
      313279911328282926		; B O13
      2229465648909980736		; B O14
      2079145828865947280		; B O15
      4322007819164873787		; B O16
      1749778447269960210		; B O17
      3862842027555384503		; B O18
      964605004439559528		; B O19
      2395925467944839465		; B P1
      590130149089506818		; B P2
      2116089079826867965		; B P3
      2073625556716630641		; B P4
      913714912618076019		; B P5
      4419286209482004018		; B P6
      3551189882054384975		; B P7
      2270494315753511310		; B P8
      3790698345740727823		; B P9
      2702723024536014837		; B P10
      3487766012849045673		; B P11
      786798038313851765		; B P12
      2493961473965179927		; B P13
      587839714080952039		; B P14
      711983022655866639		; B P15
      3600122666799411627		; B P16
      4595379369086188262		; B P17
      660412941998754877		; B P18
      3600493847520017697		; B P19
      2286146970913258211		; B Q1
      4433809371640026623		; B Q2
      1899980558640195147		; B Q3
      2286057142216080237		; B Q4
      374364459951336236		; B Q5
      3845433341147377175		; B Q6
      1198661494772096210		; B Q7
      2588296368242518007		; B Q8
      3081140403778663683		; B Q9
      3799577584957054135		; B Q10
      3651221632577351923		; B Q11
      1513946482383552148		; B Q12
      1949994764172596931		; B Q13
      2620196255487122118		; B Q14
      3070653226553622712		; B Q15
      2231293163211266979		; B Q16
      1359705196877070748		; B Q17
      960667610599053826		; B Q18
      3342575564535827866		; B Q19
      4218063477312362121		; B R1
      4387404099243435228		; B R2
      1169606658102963819		; B R3
      2037268763278397583		; B R4
      3401674099548367450		; B R5
      4323885684105421997		; B R6
      2009566426152602963		; B R7
      655947564944123803		; B R8
      246769788665549528		; B R9
      3276187046367894703		; B R10
      2740992425401224307		; B R11
      2470595533253566975		; B R12
      569811601984495424		; B R13
      3489048637714390553		; B R14
      946429842581180751		; B R15
      839950891950214807		; B R16
      1529904417763692270		; B R17
      4004201209313612948		; B R18
      2733778047512301397		; B R19
      465377784904672490		; B S1
      1700911794987935060		; B S2
      1088958322184437159		; B S3
      1920305113879566117		; B S4
      1805552449986059497		; B S5
      3616053484699537527		; B S6
      1000541890507753404		; B S7
      3267057367790836222		; B S8
      3003278641517699742		; B S9
      1491031844626095923		; B S10
      2739085908329555420		; B S11
      2179578737244419730		; B S12
      4398034483975739928		; B S13
      737539585849475624		; B S14
      3816952656911809967		; B S15
      4602308049268427282		; B S16
      698197176781607625		; B S17
      3034905119385820557		; B S18
      3963097388590854637		; B S19
      257462653643752054		; B T1
      1258142564679297681		; B T2
      1848761175361486982		; B T3
      3285677765020636295		; B T4
      2022407186646178540		; B T5
      1046016949108085289		; B T6
      403719458570521846		; B T7
      1583634033501235265		; B T8
      3240521660734120316		; B T9
      3854385740524066487		; B T10
      2862078044036785988		; B T11
      3235396224103494965		; B T12
      4030026961684129013		; B T13
      2990816347880191792		; B T14
      1918674884207690201		; B T15
      4529525635377151817		; B T16
      4358365295760141923		; B T17
      1141141809267713820		; B T18
      3397781408256637212		; B T19
      1793232905368123677		; W A1
      921174841881451712		; W A2
      2474131442823885333		; W A3
      3921806092389609644		; W A4
      2673702067738252722		; W A5
      1318071802643431916		; W A6
      4473087582746608070		; W A7
      991593485157800364		; W A8
      3536647663658974785		; W A9
      245031762537649935		; W A10
      2715201116948922812		; W A11
      3627703344296943497		; W A12
      1722381986871209428		; W A13
      1058232439074390731		; W A14
      3801092978965525015		; W A15
      1875469328979776458		; W A16
      4526641408453146992		; W A17
      1514345500479901580		; W A18
      873394609340253134		; W A19
      1144532298054957297		; W B1
      889944184514252597		; W B2
      855029936525502237		; W B3
      100131522990555274		; W B4
      210770458655289868		; W B5
      2417814685683253135		; W B6
      1658208374441006814		; W B7
      1491648394141065743		; W B8
      502499134516976807		; W B9
      2861730807625480621		; W B10
      622982552296361571		; W B11
      2013539811533211743		; W B12
      1398426532495831020		; W B13
      1625116108952189449		; W B14
      811159679441531006		; W B15
      4543680720201873471		; W B16
      190676904605619078		; W B17
      893695643050954651		; W B18
      3097505787959442273		; W B19
      1908647370193879831		; W C1
      481505517894550138		; W C2
      4237391422184723836		; W C3
      3823151969817281665		; W C4
      578804458420770016		; W C5
      700551606195478586		; W C6
      3551588248020471284		; W C7
      1045374000927646069		; W C8
      2702831525993600257		; W C9
      1136147236663755767		; W C10
      556640291174936066		; W C11
      1615637217417770350		; W C12
      1989774884143741886		; W C13
      4450351766992446001		; W C14
      1933463122110454130		; W C15
      2359124186370584830		; W C16
      913853688970465850		; W C17
      4339216655179597465		; W C18
      2591318951968910055		; W C19
      903157806397346692		; W D1
      4322829903468349437		; W D2
      946906170373819780		; W D3
      1344496529052404798		; W D4
      1633043423907716061		; W D5
      891916024752010955		; W D6
      3560371676036936939		; W D7
      3388954105628334976		; W D8
      2436500502342577574		; W D9
      4108542495397076499		; W D10
      2035662415439234935		; W D11
      2167360561963863490		; W D12
      2595787459179327055		; W D13
      1453865640392203667		; W D14
      2837331121216053842		; W D15
      4595664286964602297		; W D16
      1534505781846442316		; W D17
      4427814885233369658		; W D18
      4331791903088487562		; W D19
      4334201635086781038		; W E1
      4069324423832256279		; W E2
      2156983201231521287		; W E3
      1590746290355286053		; W E4
      2147876564915638509		; W E5
      2198829821810626371		; W E6
      3413172977339504100		; W E7
      1806704303077842484		; W E8
      726136643474106237		; W E9
      2170313226280096047		; W E10
      3800543185900279789		; W E11
      1598715629710652281		; W E12
      404609372034508165		; W E13
      3794025176908047598		; W E14
      2550661475853460319		; W E15
      955145239597753532		; W E16
      4223442008632735857		; W E17
      2618342349674457732		; W E18
      4325399337644875359		; W E19
      2801055536132961273		; W F1
      589040934877534847		; W F2
      1855859156805360369		; W F3
      812880474959024047		; W F4
      4378759360855453722		; W F5
      569492619681279086		; W F6
      1687853689136708915		; W F7
      2865063796204697995		; W F8
      1934071976138349091		; W F9
      2071273594932592211		; W F10
      635082534476439295		; W F11
      766836962780258230		; W F12
      1909854853909307407		; W F13
      3955400087260431517		; W F14
      3366254024749243537		; W F15
      3592543966541287123		; W F16
      149405296407249491		; W F17
      3369156304950417784		; W F18
      2868432462883777239		; W F19
      2024623357762805416		; W G1
      3389770925176011020		; W G2
      3458041479814400028		; W G3
      298446896462489841		; W G4
      882312511065530195		; W G5
      4383015916152593642		; W G6
      349718245205960027		; W G7
      2693349083156201681		; W G8
      423145966889157328		; W G9
      686857745518983980		; W G10
      3196726861057442402		; W G11
      3312379640614864657		; W G12
      3721431978023788607		; W G13
      2026507040748810592		; W G14
      1095797428277165581		; W G15
      1214006731650234610		; W G16
      419149289149507700		; W G17
      3623549109553068245		; W G18
      2311970675964809581		; W G19
      2400870388857350386		; W H1
      1703600002360708888		; W H2
      144259026681649253		; W H3
      3193304492502760980		; W H4
      2869818644109599254		; W H5
      4112194686913905039		; W H6
      575709908169951202		; W H7
      2007336637936081033		; W H8
      2430660626971072549		; W H9
      2333510679653078343		; W H10
      2477458706962062508		; W H11
      1818740009787597558		; W H12
      2619940227908599002		; W H13
      3103688649724576633		; W H14
      3620153658643070668		; W H15
      1244782171101863181		; W H16
      1225398774238999438		; W H17
      4013334681477877135		; W H18
      19218691040557925			; W H19
      2636453002424953484		; W J1
      3748806754038592438		; W J2
      1028183589919013345		; W J3
      3402200614240211584		; W J4
      3911278647257558549		; W J5
      1426796737919056508		; W J6
      3021584195017569841		; W J7
      3813222606480354780		; W J8
      1066018230788762961		; W J9
      1170058226199884799		; W J10
      3065914638192719692		; W J11
      2259675485881990532		; W J12
      4389121107515444796		; W J13
      3143915815485796851		; W J14
      143741634015905786		; W J15
      2707969488570409574		; W J16
      1364962574810191819		; W J17
      3395972963150100194		; W J18
      2811068554022395671		; W J19
      4295051364528142854		; W K1
      2807298929715793321		; W K2
      2226004551861958375		; W K3
      2847620322473006508		; W K4
      2422891360309379268		; W K5
      2972397081176625883		; W K6
      149647952496836515		; W K7
      2234105921178942692		; W K8
      1859002749557646025		; W K9
      3422529731419742432		; W K10
      814398566026012200		; W K11
      565010986137461706		; W K12
      1520443100125322324		; W K13
      1798376680510725472		; W K14
      1573716282486534651		; W K15
      908041336289123732		; W K16
      3737172710533452031		; W K17
      3184750167278947694		; W K18
      2021879631413608040		; W K19
      1075799317368214546		; W L1
      4474172203338020599		; W L2
      3215909176812377178		; W L3
      3308530279165183338		; W L4
      2303495783664006586		; W L5
      450728029065655980		; W L6
      741287170264004598		; W L7
      1245534881830620488		; W L8
      2835082604411402665		; W L9
      3817294002294771518		; W L10
      3426129792221556815		; W L11
      3834826071002631346		; W L12
      4436043524371019616		; W L13
      256371758327223284		; W L14
      172059830885475730		; W L15
      4439173281956642567		; W L16
      4495256423765515232		; W L17
      1953886767409295587		; W L18
      3349198740487472733		; W L19
      3933963321823215884		; W M1
      3913720303626237533		; W M2
      1817350038197574754		; W M3
      1357209501164980491		; W M4
      3228359830704813874		; W M5
      3017332201790830780		; W M6
      3061923786645405636		; W M7
      2663513771964263802		; W M8
      305445073675018328		; W M9
      3739197677920356945		; W M10
      2833242420500247731		; W M11
      3753120409548574494		; W M12
      754178173198895475		; W M13
      3315505288942933200		; W M14
      674468612665695416		; W M15
      1092118332961008950		; W M16
      4586208779696330057		; W M17
      2217059169654285780		; W M18
      462001837145353942		; W M19
      1398883524295860422		; W N1
      856841011818191299		; W N2
      2746365148903698229		; W N3
      3045435425214674193		; W N4
      3334023199709115184		; W N5
      99367895507886986			; W N6
      378818310309969483		; W N7
      3203749662968909926		; W N8
      2835262435978617680		; W N9
      3368625733424962131		; W N10
      3016270854998305783		; W N11
      3156187271660587942		; W N12
      823792589773116305		; W N13
      1427670924350111493		; W N14
      3505537982858651754		; W N15
      140448662297850833		; W N16
      35904614751269422			; W N17
      4218207487375187552		; W N18
      1184042837791194159		; W N19
      319673009513437901		; W O1
      3158122903445266982		; W O2
      3969970121913372802		; W O3
      2620559699767203970		; W O4
      3118390575649390830		; W O5
      2596602059653094375		; W O6
      1220069565928423114		; W O7
      1243824520342379651		; W O8
      1190548582155046652		; W O9
      720779167065159194		; W O10
      1886435900900333654		; W O11
      103977279898240947		; W O12
      2502510972123126426		; W O13
      3705847780426394581		; W O14
      3578007207842115039		; W O15
      1107151853306996869		; W O16
      2153655352449775059		; W O17
      2420005017425539844		; W O18
      1938266719301498072		; W O19
      4556406082443003929		; W P1
      4135234267990942876		; W P2
      2812225892474903414		; W P3
      1936735557406056747		; W P4
      2531731277899807424		; W P5
      2622890105387534292		; W P6
      463658657559793895		; W P7
      3156463876060395897		; W P8
      3396050872696032787		; W P9
      4164818639078765498		; W P10
      2220299678802414385		; W P11
      1688985404773750673		; W P12
      4320775058620116943		; W P13
      1310196130081587362		; W P14
      3262400065126276747		; W P15
      3825560078167550775		; W P16
      282641575238602755		; W P17
      3220449148549194092		; W P18
      4127835461129620876		; W P19
      2279349973853858765		; W Q1
      1614096637889568233		; W Q2
      2584694064822144271		; W Q3
      3331793500798323433		; W Q4
      831046288634743980		; W Q5
      4116824032625053313		; W Q6
      1797407277857266808		; W Q7
      2962857446242726657		; W Q8
      2469439887565515271		; W Q9
      2349128313366745916		; W Q10
      399368577400552545		; W Q11
      2961993555581038115		; W Q12
      932642574743257964		; W Q13
      4535085649433355927		; W Q14
      1164225950659217132		; W Q15
      2459067566145290554		; W Q16
      2163420004335526240		; W Q17
      1392634287551184498		; W Q18
      554356065466909299		; W Q19
      462455297885980731		; W R1
      4586394850448997929		; W R2
      3719578716340433626		; W R3
      4200560277622579521		; W R4
      1004417540290580096		; W R5
      4355354492881787481		; W R6
      553253795986341271		; W R7
      657888159558715690		; W R8
      1606291108191240955		; W R9
      960917404550278040		; W R10
      4411444886823745798		; W R11
      1234940535266042466		; W R12
      3493783056444960480		; W R13
      335316275556167898		; W R14
      3391223868407592273		; W R15
      622328145615117301		; W R16
      629726940147247934		; W R17
      2496941029083665035		; W R18
      2748655211138980768		; W R19
      2323139156228708113		; W S1
      2543233943052415898		; W S2
      4017730378538483790		; W S3
      3359909761467895116		; W S4
      771440405390700823		; W S5
      1972725433521460097		; W S6
      2148003231705581305		; W S7
      3498628007424077375		; W S8
      1926868073920551815		; W S9
      2963083658971061409		; W S10
      4322983716877464211		; W S11
      3607799300873661533		; W S12
      3258519172976700944		; W S13
      4395900892437956391		; W S14
      310484270527412079		; W S15
      1599319210917391875		; W S16
      2995416610229520349		; W S17
      4504054632123294782		; W S18
      839460612859473333		; W S19
      3323704261934410761		; W T1
      513683389926172104		; W T2
      2980874215427020548		; W T3
      1893340930183385352		; W T4
      9593272128892368			; W T5
      1540915041215217654		; W T6
      955403211498249785		; W T7
      1541605790992062045		; W T8
      218038996092964147		; W T9
      1523566917997454285		; W T10
      4050354119363449844		; W T11
      4540778771213991888		; W T12
      1928317496629981601		; W T13
      4081504782019249140		; W T14
      1779165607710864119		; W T15
      2518789639089105444		; W T16
      3775953752975286573		; W T17
      3014701365809274130		; W T18
      4016447757271470284)		; W T19
  :test #'equalp)

(defun zobrist-hash (point color)
  (aref +board-hashes+ (hash-index point color)))
